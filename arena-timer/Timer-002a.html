<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>64x32 LED Matrix Timer (True LED)</title>

<style>
  body {
    background:#111;
    color:#ddd;
    font-family:Arial, sans-serif;
    display:flex;
    gap:20px;
    padding:20px;
  }

  #panel {
    background:#1e1e1e;
    padding:24px;
    border-radius:10px;
    width:220px;
  }

  label { display:block; margin-top:10px; font-size:14px; }
  input, select, button { width:100%; margin-top:5px; }
  .row { display:flex; gap:10px; }

  canvas {
    width:800px;
    height:400px;
    image-rendering: pixelated;
    background:#000;
    border-radius:6px;
  }
</style>
</head>

<body>

<div id="sketch-holder"></div>

<div id="panel">
  <h3>Timer Control</h3>

  <label>Duration</label>
  <div class="row">
    <input type="number" id="minutes" value="3" min="0">
    <input type="number" id="seconds" value="0" min="0" max="59">
  </div>

  <button id="start">‚ñ∂ Start</button>
  <button id="pause">‚è∏ Pause</button>
  <button id="reset">üîÑ Reset</button>
  <button id="flip">üîÅ Flip</button>

  <label>Font</label>
  <select id="font">
    <option value="bold">FreeSansBold</option>
    <option value="sans">FreeSans</option>
    <option value="mono">Monospace</option>
    <option value="retro">Org_01 (retro)</option>
    <option value="tiny">Picopixel</option>
  </select>

  <label>Digit Size</label>
  <input type="range" id="digitSize" min="10" max="40" value="20">

  <label>Letter Spacing</label>
  <input type="range" id="spacing" min="-2" max="6" value="2">

  <label>Brightness</label>
  <input type="range" id="brightness" min="40" max="255" value="220">
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

<script>
/* =====================
   LED MATRIX CONFIG
===================== */
const LED_W = 64;
const LED_H = 32;
const LED_SIZE = 10;       // visual scale
const LED_GAP  = 1.2;      // spacing between LEDs
const LED_RADIUS = 3;      // corner rounding

/* =====================
   TIMER STATE
===================== */
let remaining = 180;
let running   = false;
let flipped   = false;

/* =====================
   COLOR THRESHOLDS
===================== */
const thresholds = [
  { seconds: 60,  color: [255, 0, 0] },
  { seconds: 120, color: [255, 255, 0] }
];
const defaultColor = [0, 255, 0];

/* =====================
   OFFSCREEN BUFFER
===================== */
let buffer;

/* =====================
   HELPERS
===================== */
function getInputSeconds() {
  const mins = int(document.getElementById("minutes").value) || 0;
  const secs = int(document.getElementById("seconds").value) || 0;
  return mins * 60 + constrain(secs, 0, 59);
}

function getTimerColor() {
  for (let t of thresholds) {
    if (remaining <= t.seconds) return t.color;
  }
  return defaultColor;
}

/* =====================
   TIMER CONTROLS
===================== */
function startTimer() {
  remaining = getInputSeconds();
  running = true;
}
function pauseTimer() { running = false; }
function resetTimer() {
  remaining = getInputSeconds();
  running = false;
}
function flipDisplay() { flipped = !flipped; }

/* =====================
   TIMER TICK
===================== */
setInterval(() => {
  if (running && remaining > 0) remaining--;
}, 1000);

/* =====================
   P5 SKETCH
===================== */
function setup() {
  const c = createCanvas(
    LED_W * LED_SIZE,
    LED_H * LED_SIZE
  );
  c.parent("sketch-holder");

  pixelDensity(1);
  noSmooth();

  buffer = createGraphics(LED_W, LED_H);
  buffer.pixelDensity(1);
  buffer.textAlign(CENTER, CENTER);

  select("#start").mousePressed(startTimer);
  select("#pause").mousePressed(pauseTimer);
  select("#reset").mousePressed(resetTimer);
  select("#flip").mousePressed(flipDisplay);
}

function draw() {
  background(0);
  buffer.clear();

  if (flipped) {
    buffer.push();
    buffer.translate(LED_W, LED_H);
    buffer.rotate(PI);
  }

  const fontSel    = select("#font").value();
  const digitSize = int(select("#digitSize").value());
  const spacing   = int(select("#spacing").value());
  const bright    = select("#brightness").value() / 255;

  buffer.textStyle(NORMAL);

  switch (fontSel) {
    case "bold":   buffer.textFont("Arial"); buffer.textStyle(BOLD); break;
    case "sans":   buffer.textFont("Arial"); break;
    case "mono":   buffer.textFont("monospace"); break;
    case "retro":  buffer.textFont("Courier"); buffer.textStyle(BOLD); break;
    case "tiny":   buffer.textFont("monospace"); break;
  }

  buffer.textSize(digitSize);

  const [r, g, b] = getTimerColor();
  buffer.fill(r * bright, g * bright, b * bright);
  buffer.noStroke();

  const mins = floor(remaining / 60);
  const secs = remaining % 60;
  const display = nf(mins, 2) + ":" + nf(secs, 2);

  const charW = digitSize * 0.6 + spacing;
  let x = LED_W / 2 - (display.length * charW) / 2;
  const y = LED_H / 2;

  for (let ch of display) {
    buffer.text(ch, x, y);
    x += charW;
  }

  if (flipped) buffer.pop();

  /* =====================
     LED RENDER PASS
  ===================== */
  buffer.loadPixels();

  for (let y = 0; y < LED_H; y++) {
    for (let x = 0; x < LED_W; x++) {
      const idx = 4 * (y * LED_W + x);
      const r = buffer.pixels[idx];
      const g = buffer.pixels[idx + 1];
      const b = buffer.pixels[idx + 2];
      const a = buffer.pixels[idx + 3];

      if (a === 0) continue;

      // Quantize brightness like real LEDs
      const level = 6;
      const qr = round((r / 255) * level) * (255 / level);
      const qg = round((g / 255) * level) * (255 / level);
      const qb = round((b / 255) * level) * (255 / level);

      fill(qr, qg, qb);
      noStroke();

      rect(
        x * LED_SIZE + LED_GAP,
        y * LED_SIZE + LED_GAP,
        LED_SIZE - LED_GAP * 2,
        LED_SIZE - LED_GAP * 2,
        LED_RADIUS
      );
    }
  }
}
</script>

</body>
</html>
